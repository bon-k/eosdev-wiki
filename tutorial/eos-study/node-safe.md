# 노드를 안전하게 종료하기

## 개요

노드를 안전하게 종료하는 방법에 대해 학습한다.

블록 생성 중 강제로 nodeos를 종료 시킬 경우 데이터가 깨져서 정상적으로 동작하지 않는다. 자주 발생하는 문제이기 때문에 조심하도록 하자. 이 페이지에서는 포 그라운드, 백 그라운드 상태에서 노드를 안전하게 종료하는 방법에 대하여 기술한다.

### 노드를 안전하게 종료해야 하는 이유

블록을 생성하는 상태에서 강제로 노드를 종료 시킬 경우 지금까지 생성한 블록 데이터가 깨지기 때문에 더 이상 노드를 구동할 수 없는 상태가 되어 버린다. 테스트 용도로 쓰고 있는 노드라면 저장된 블록을 모두 제거하고 다시 구동하면 되지만 메인 넷 풀 노드로 구동을 하고 있던 노드일경우 몇천만 개 이상의 블록 데이터가 저장되어 있어 블록을 모두 제거하고 다시 싱크를 하게 될 경우 너무 많은 시간을 소모하게 된다. 또한 테스트 용도라고 하더라도 기존에 생성했던 모든 정보가 날아가기 때문에 노드를 종료할 때는 안전하게 종료를 하여 블록이 손실되지 않도록 하자.

물론 [nodeos](../../keywords/n/nodeos.md) 옵션을 통해서 깨진 블럭을 복구하는 방법도 존재한다. 이 방법은 내가 보유한 블록 데이터를 1번부터 전부 조회해서 한개씩 복구하는 옵션이기에 블럭의 숫자가 많으면 많을수록, 블럭안에 들어가있는 트랜잭션이 많으면 많을수록 많은 시간이 소모 된다. 가장 좋은 방법은 역시 노드를 안전하게 종료하여야 하는 것이고, 어쩔 수 없이 노드가 비정상적으로 종료되어 블록 데이터가 깨졌을 경우 [블럭 복구 옵션](../../keywords/n/nodeos.md#undefined-1) 페이지를 참고하여 복구하면 된다.

## 노드를 안전하게 종료하기

노드를 구성할 때는 포그라운드 상태와 백그라운드 2가지 상태가 있을 것이다. 각자의 방법에 따라 노드를 안전하게 종료하는 방법을 배워보자.

### Foreground 상태에서 종료하는 방법

해결 방법은 매우 간단하다. `control + c`를 눌러서 안전하게 종료하면 된다. 이 방법은 EOS 뿐만 아니라 모든 리눅스 계열의 공통적인 해결 방법이다.

### Background 상태에서 종료하는 방법

#### 1. 백 그라운드로 동작중인 nodeos 를 찾는다.

```text
ps -ef | grep "nodeos"
```

> ```text
> 501 11547 11462   0  4:00PM ttys000    0:00.67 ./nodeos
> 501 11610 11576   0  4:01PM ttys001    0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn nodeos
> ```

현재 사용하고 있는 OS 와 터미널에 따라서 조금 다르게 표현이 되겠지만 일반적으로 위와 같이 표현 될 것이다.

#### 2. 백그라운드로 동작중인 nodeos를 종료한다.

위에서 표시된 숫자를 보고 kill -2 옵션을 사용한다.

```text
kill -2 11547
```

참고로 -2 옵션을 주지 않는다면 디폴트로 -9인 강제로 종료하는 옵션이 적용되기 때문에 -2를 절대 빼먹으면 안 된다. 

```text
ps -ef | grep "nodeos"
```

> ```text
> 501 11610 11576   0  4:01PM ttys001    0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn nodeos
> ```

다시 확인을 해 보면 정상적으로 종료된 것을 볼 수 있다. 다시 nodeos를 구동해보면 블록이 깨지지 않은 채 정상적으로 구동되는 모습을 볼 수 있다.

